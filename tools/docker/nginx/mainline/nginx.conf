# max_clients = worker_processes * worker_connections
worker_processes      auto;

worker_rlimit_nofile    36384; # has to be bigger than worker_connections

events {
  worker_connections    18342;
  use epoll;
  multi_accept on;
}

http {

  # Hide nginx version information.
  server_tokens                   off;

  # Define the MIME types for files.
  include                         mime.types;
  default_type                    application/octet-stream;

  # Update charset_types due to updated mime.types
  charset_types                   text/css text/plain text/vnd.wap.wml application/javascript application/json application/rss+xml application/xml;

  log_format                      logstash '$http_host '
                                            '$remote_addr [$time_local] '
                                            '"$request" $status $body_bytes_sent '
                                            '"$http_referer" "$http_user_agent" '
                                            '$request_time '
                                            '$upstream_response_time';
  access_log                      /var/log/nginx/access.log logstash;
  error_log                       /var/log/nginx/error.log;
  keepalive_timeout               20s;
  sendfile                        on;
  tcp_nopush                      on;


  proxy_cache_path                /var/cache/nginx levels=1:2
                                  keys_zone=STATIC:75m
                                  inactive=24h
                                  max_size=512m;


  proxy_temp_path                 /var/tmp;

  gzip                on;

  gzip_comp_level     5;
  gzip_min_length     256;
  gzip_proxied        any;
  gzip_vary           on;
  gzip_types
    application/atom+xml
    application/javascript
    application/json
    application/ld+json
    application/manifest+json
    application/rss+xml
    application/vnd.geo+json
    application/vnd.ms-fontobject
    application/x-font-ttf
    application/x-web-app-manifest+json
    application/xhtml+xml
    application/xml
    font/opentype
    image/bmp
    image/svg+xml
    image/x-icon
    text/cache-manifest
    text/css
    text/plain
    text/vcard
    text/vnd.rim.location.xloc
    text/vtt
    text/x-component
    text/x-cross-domain-policy;
  # text/html is always compressed by HttpGzipModule

  include             sites-enabled/*;
}

